<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.56.3" />


<title>Automatically Building, Testing and Deploying bookdown with Travis and GitHub Pages - Random R Ramblings</title>
<meta property="og:title" content="Automatically Building, Testing and Deploying bookdown with Travis and GitHub Pages - Random R Ramblings">




  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/dracula.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.JPG"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/nathaneastwood">GitHub</a></li>
    
    <li><a href="https://www.linkedin.com/in/nathaneastwood/">LinkedIn</a></li>
    
    <li><a href="https://stackoverflow.com/users/3759418/nathaneastwood">Stack Overflow</a></li>
    
    <li><a href="https://twitter.com/nathaneastwood_">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">Automatically Building, Testing and Deploying bookdown with Travis and GitHub Pages</h1>

    
    <span class="article-date">2017-05-16</span>
    

    <div class="article-content">
      


<p>I recently began writing some documentation around coding standards using <code>bookdown</code>. The workflow I was using was to write the new sections of the book, build the book and then push the changes to GitHub where it is <a href="https://datasciencecampus.github.io/coding-standards/">hosted</a> using GitHub Pages. This was clearly one manual step too far for me as I consistently forgot to build the book before I pushed the changes to GitHub meaning those changes were not shown on the subsequent web pages. Then when I finally did manage to convert the <code>Rmarkdown</code> to <code>html</code>, I found that some links would be broken or missing, I therefore needed two things:</p>
<ol style="list-style-type: decimal">
<li>I needed a way to automatically build the book.</li>
<li>I needed a way to test my html files.</li>
</ol>
<p>I was already familiar with Travis having used it for some of my packages. I therefore decided that a smart way to handle the build would be to build the book on Travis and push the subsequent <code>docs</code> folder back to my <code>gh-pages</code> branch on GitHub using Travis’ inbuilt <a href="https://docs.travis-ci.com/user/deployment/pages/">deployment method</a> for deploying to GitHub Pages. But before it pushed these changes, I would be able to test the <code>html</code> files with the <code>Ruby</code> library, <a href="https://github.com/gjtorikian/html-proofer"><code>html-proofer</code></a>.</p>
<blockquote>
<p>HTMLProofer is a set of tests to validate your HTML output. These tests check if your image references are legitimate, if they have alt tags, if your internal links are working, and so on. It’s intended to be an all-in-one checker for your output.</p>
</blockquote>
<p>We can achieve all of this with the following <code>.travis.yml</code> file.</p>
<pre><code>language: R
sudo: required
cache: packages

r_packages:
  - bookdown

before_script:
  - chmod +x ./scripts/cibuild

before_install:                           # Install Ruby and html-proofer
  - rvm get stable --auto-dotfiles
  - rvm install 2.3.3
  - gem install html-proofer

script:
  - ./scripts/cibuild

deploy:
  provider: pages                         # Specify the gh-pages deployment method
  skip_cleanup: true                      # Don&#39;t remove files
  github_token: $GITHUB_TOKEN             # Set in travis-ci.org dashboard
  local_dir: docs                         # Deploy the docs folder
  on:
    branch: master

env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true  # Speed up the html-proofer

notifications:
  email: false</code></pre>
<p>Note, the <code>GITHUB_TOKEN</code> is a GitHub Personal Access Token (PAT) that you store in the <a href="travis-ci.org">travis-ci.org</a> dashboard under the settings for the repository.</p>
<p><img src="/img/github_token.png" width="800px" /></p>
<p>The <code>cibuild</code> is then a simple file that first renders the book (<code>_build.sd</code>), thus creating the <code>html</code> files within a <code>docs</code> folder (which is specified in the <code>output_dir:</code> tag in my <code>_bookdown.yml</code> file) and then it runs the <code>html-proofer</code> on the resulting <code>html</code> files.</p>
<pre><code>. _build.sh
htmlproofer ./docs</code></pre>
<p>Where the <code>_build.sh</code> script is just:</p>
<pre><code>#!/bin/sh

Rscript -e &quot;bookdown::render_book(&#39;index.Rmd&#39;, &#39;bookdown::gitbook&#39;)&quot;</code></pre>
<p>If all is well, Travis will then push the <code>html</code> files back to the <code>gh-pages</code> branch, thus updating the hosted version of the book.</p>

    </div>
  </article>

  
    <div id="disqus_thread">
      <script>
        (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://YOUR-SHORTNAME.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-87791665-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

